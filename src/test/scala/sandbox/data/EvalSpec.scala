package sandbox.data

import cats.Eval
import org.scalatest.{FlatSpec, Matchers}

class EvalSpec extends FlatSpec with Matchers {
  "Eval" should "calculate factorial in stack safe mode" in {

    def factorial(n: BigInt): Eval[BigInt] = {
      if (n == 0) Eval.now(BigInt(1))
      else Eval.defer(factorial(n - 1).map(_ * n))
    }

    factorial(7500).value.toString should be(
      "122316925051804770559455145536350220679541970696039184924104672633645962024328223806987817360628334865833084548622032141980240069420362568982193651813677777891478028483192992848986951865540969766283810478420100668581061165055408810648953470196140550934830276210269667220621299823353251139703360648892117015298060828309820496494873461658419453012155651530626585238932635537110627801754758108725412479935331576763011693652060417487815902549452295682634852639030500829697194516440448104689645977626962343168157112621653828741842070970407433347373179324160439004200802793479221589576910750502668035551553917077759163110214993075266327942236737739714794186757240833409397366169829368678505555470603461494132457111505374690579818465782114864411672332024709177861669707248281450621501093456646414991990351359557758423408007601110954116096416364827838845274853582842053396697316332991179147022483529976491049549809907236375686968657438941781487320143912179574813197256207258368535116063335815365126259644127034615845252971912296452737130397020294222109312419178277656143352772021303113370610835742891260999971809364879483489624943532420791093977285292181987636545694922134429080013928239443506876631302189495557670312343483386063442273353100373100391528837942643557044817643102742305931757685639859875527813520135314220858203436840043707419685328239833625194021922868610631681665396467849600157218419067976375760473347003031597968270710246547459695542027964156948962787137326408183007899580692937851553293388666735505917666882219646323978292122850788707039007842726480544221792754883221403725254060681455137121240624991781662254309174790941380058925638778812116400570595237946738619300444738201591113566944603272027054566548943008442964381810684678496479186680777653178879006951293516894763719752490317462530535954084220612041776548096522387310928304502025043522513498442506068475834403357948178149015377439580987666781940129816981262172178704341729290474186123870428161369416900639087739130266523780527305834063514141716409852696391948171660696357559229805753685701479958776652438334439668487068909179087748518282338167781523900441980973985020546412811143549921084830876987794319818912900820399970887262501954446143250375111095363143347977367900986673703506214648932564110214476449633884892302745329656982692812697572396640283859626221500867011017134740623916425285381995716231590439329227697284490162310837254980993389089915187892982441585945743608927618899564098939388174645905608959311123948046053981555594573243640633626717295509036522120108459101688022412231372431046323424426575554178106394540662126509142637994657669714901700421055726463122945802522844694355855147288702035023367361759459565688557421963879253055643659866186703685257116307102802785126000736269193184393610716104242008461464210470275936095259919531713979404654200809739057644286233824187629012563172839885855151796368169446449543132936131987948085263498317499286671517854942213446986165079685224484894689900535050147756330159749906970110947073480366001782867833638092091251765150918936168836658243291904313694238375460225747494965107410023635736499013574352603553346709745917034340479542492075887759918445711072739374790068897967531708098409510978896674310963161040609339733479410726734196204038433257658787816520480174406776497077650233308847133542171607131461841619185578790556862827529738101904108645089802909506200562444083065282803030810523037760171356394943008479280730185643235241154743148506907290794445448773625936336697174337994592041516771509159403849325404657139547307624326051892082671426705203586104780137834704694377868996753993781083067337988079723419702503952231367260549010087262008404367616236805775382849159543654957248378189209083106808844121708327988509136983073421448416822005719970032740296995957017197305541876495920765373613488123477309114607023673199236870737848800753368613106992553584969386245427680517870275885506352770665802685243905112762879823717756823162918048286340923609470762602491678846669469334362135832556299318378215605645803168929327911504976728176716849822205771280586232827013253308981745362004411588992741778832915667294954734777475688706472644168559902961951966327488171082400926806778431858253452621609573744287774939433842498460856662923929461311619304426579548441869936020640840452802180501887888066453032000389554580210305493280685605130088053657451855973131408228587079498133658372593384159856096530935925260247930761236841605484560406963931422468872468664053791030793884499899118586673026692234964341498807327535377704627864449267636970486809526559669306587407944119648137653087168283106705413776464901752841827760029627012120832498848436564149759385526374815546477541399724516523582679339373902069395142371114665142166854667760827448822518024792184456832339726355084049496784534272322589257218136304310791705738879628059137368146754676695494546422750945230051670184003849466702402013463214846307786656713568828357643955681132705134350704422564613400628543794754893969573096480235378233304628249900711011281920052618223027884817860333281276960887411673880074372975444531068727181514749302494918154965964202593706913309470945987071917245303821331680053121609311125498149172948029943593630601177143533896720651700732956560571058968715027300911991272913104697580325529017043098205245478015992436320039444131564578404879031495569973716482823025622275235749849229021411776985025802800072077288745907726084284043284734416576126316608407436616154059547355432650953093409971079596139383501301420280883304928600141468964650531805657195559261536260526472827585803323317539741732791253846457007005307725233887688228609928956611000143172042657878874425587123254006123435338297103573415011644575317319879504810559424419442998900086705032720503719522496203664677842163331681786750207449526873896743910245772281640717582933686549815776808416199426967716715967422201888970020708731761228880418861968676165469201220089333996753175314528792398327731543454591879163175741808571143257994207695676880612232126784384791826313849955745390167123164936492440413757712047189872975227556406281422379291304496395376707709685780623656549215005938472684085684475607204663419361884340344975795213613010862264804216791875001990149173664900812651151719194171162298912913074396109053331772229742635295228379403667531188499350658848798267481554474535213419219979652118249693538657339626893295521988651345914208084321267147544070949540163216646020707228629297287366188099240982805458894296353811504761373918123782919705386348150164961972838819914492567067835009007358598845990966014209245872387348386159510180219322602390570948579233532526253544419277386872246581960480032416109198829748890003640758725416184575130206898562312152784196797271541453420880453382928644020431486752781235372025912028729695439015087853716107865770242170628662614960110125953283218716667865493158935515890027469998850278848964269523540410684162187966940699695925007010464475964672759218163086110958225285564429125335388711624645825362555968085281085649194494140978380471157881321840179259530701268389546494652924347735135131690104587570219381360115435246329595498519987958331153671114826471219239698986228706768830629695067404295611892137149945161735084294933121530514164812298644024422655896441034879631813937455294765509751190925846076169630349628971205386024381609865154650585629529016419532823999570778373335066736004147574717449660147452670336521362929842153054273935545014574388976639097607639825352681283927079622575399985721662256913670738666886384221317954073214362035100567131023775548891235010247974913205412587604943115096064202282870145438037041274017013890985040820237390201514045695175608230547590117160945784301299129067488105184879792651202161981719566197950904687991055426909223980043548030591267563453000878783511827798491747110949888879922131810957153735125499427179855893435037710244681069582646333056079632011237765162916441626474400020201984557043863331731556149137658290807686517624983553826832034633513369794836136547207732966157530317816801315226454160916327406373947517973933637602606093147800626398668144269965498716769206885039379815141113654161989300254525786826304641187733530041349245435544435897886248205409109562453454991932096117340288613100032761036031475903173584083259408167716457820688472917180027163063898026549042895029523505068456924680923084824294126951994301676703202026251502195642882944907952379965837814482803525690815083382931160071262871659672654668435459147950881572219978211241988722075943968250825245119580602293327635420306649495992536707159688162816513324373771556344651741989376393022252705230204121072986694893361681682136995517376485397924443333542309520744132729197056858676890615357336649907051408439872003983236503809036051395019661243540534232627672820502107258253809452599011900991016734212481937333164425709590667016548846766059301120952856594733455275610634011313808723842161236407703894084305246974404057708217869696359720433497704050064869186584174190025001516039423647341682300031896732374903654968870853590653389377054107809403283722972921850358739466025853375897550525456768631398936229656217426268760774018369681674842640805379256876315231806980387249087410281273014499625769870577642568615619197954544449598468286152325879520558208661517846062862268067160753070388567283606828944871261036570597540998046179310802761946191267231970276053873768382591354785410070021455422363944265552589566872828167865980313150511025514718126673528543810704564922010810469110076921938340541891030622124100652844011533503641074157556425458023349393041748153968733265938299487091287930477018906728220930785776539983003985766392955757362191332151885731714045041024650913106590336977218516271822896719068525370643861263151142741276963260783806728922355249774557339116035249866356367756568540991580051983779005291388496857398666702769288131895979477924570581453111680327888742981712727394141208596300726882976922735912771008919495608147556590561153247111584631162841412561198085498120880925821952102164813249913828371604268580574085187171830784480356220662098759294856782670041675572963721862650402205725132357962974430350450859809186883987550221158536717294350914766141213741072604845780718464226582757408878647292566502302288888810420001976755575458058780524335207200087271452725011000400731634598700806637525955448096965199577175697512732298273320910086894254631915867567734885906008635760229581071824736421347887384148808327710331747581910764648812031815364483322400513995375766950152595969902894228667552013035624142584656786137820371126455929788262156001904168356671312230291708931595864153345031999487049219116385642127113945740739324238617559072174447178247422762836099041120094949006643642455341923468418227884673789829159819310443026491563732738969636274836449978733595163303629299478670303778656836411996264899748729413521709417026028400121986377727107885716844573393596393614223002990377680292058300325417314842726729384675427586102337081470048199283807226326476267247693460107684392047736405311727005728523865996783891004902233418097145923036193241092843256476643358723406348343383279317008473249302822605941997518705978863349324758587483660381017948450522798974454987275194385385618735070716166778333544541335571780986649880447699494146055447838760953302527357054327937849527657090427682158091306129092537869521317191030191843035438994919841284410541628706251527445267334739794029573107952028295702611187956732854824209761254614424525100565777888435739376095518875389241224050828282509070386559818712490136133731048545135578101453732840466792485817571360898304145234558473839043704164613444424369306941241204403975854556752257659011187452775858235999941531384603684436174253683461081274914393140825273086321008153713721013106553530786681086881617821390490568859532115462181140035481653237976356230931440535740602852820764307983522473802321575954712764708163788077060010714115774002867217251752697954805746872610771273681707348936584727393191156282516433299916111170916141788275044878959422895448653839681114595201649686125351206049793245341158305239558159918034464786781613855085242751898320694996250888793713671723216327059812997550080181308185005529402075025679991837692654212332494107040629824142688942008716871818970651313381405375941602000417512244246257005055482036964878858665061189215572340181775184939483518056414102075548052196074184846216165143483824148470454457883730365625234644976406193528765768427755558049780553066551247581201988592195710472599980047629152604059553365515624673234996231852895079486298121010972035305522912695768333584162210464055293942957278021841550783719683754725299212278865409538810301765711450215977018198420413557921156042213260086759232501927867319862784910638572430752252050909639743994664855365901924538477839791124334106333656701779130889804977313849309217557262891916303430941891498232910509164960134739059289345564653728883494885036991978308255580021979470424477744895205214100066619236771416132496842645552169111253148893090630580417135910984058611998827128819914236421671418773616091129651556973576932322136166624577149609859290728658569281497433941026078370607445993714578254528062909444769766730345464604442791290422773423382949720083633301089646505794665043697512192789042154727196525533349779283645573118207552413271018865270498194392047669795925506536174881330183332620637777138514902590700433275514702140135259131369208150271215832908637742992508833079492169114578581499818580082523614580051766154148653036823711822622603768920302092305640463902158852435506050891447350392919282113528867714951413084047132600434745760762916143988382859619166130716082539823474106728533077255929295543290305242401441523910256770312447361794763411992272265228131149868130068282280986453690522297184490193027757763830249340995735228790523083537780130525117471016505980810277666603981807076288699274056272663864165589356625640835850661969608189133197455698673525407648236106375128329800263218179697912184659326389772855668234787188241500121591018881452446475887624689508334047908823166702870201054197166797914278939683417641636133710319331898953597865584698802548707288704814492386108983925759374827650512850722936589750368336942216566874121241398767864116457847008031580473381545691369823750544165164889408319480855412368558091681711973833576879516696755123238160163712803282199567169569249475155903520781591186135803056582477216928519711872899260348528598293668362041169835552223577397649998836929514862137499087514726353001732878656806656459652178472725644560679687911246335923161762984392480119430428212679846280595609443458023703546604205813445837396966837997256001492603451389932657618340441180232490312244212660191019663618104918178644489945853919989113309492884117302390285833032301373520481797296220290233370434189589132801052214221043240433958821479439301218784032737016195002223007214964246103750051034167783153684796718696377268141731888644447030124263381369415400670575473653113698466974274273351105878063990936862123070198726671229526705114369770029959861818113841628753217683149895905041262845978434775461201005460259390957328951972469493890706600090034473107455620073106003524896969647675883292448679932820664184994757310581244827080828769791466308786015918919826787356628404652897823396492463724831532060768537166882514105228659480048153149330406283610054045179192631521102369046693348435879927508454119455593622813769012133748516148962274555464506172218848013853083308675371437868086259226831783573637874312373896623295779042425945673149379259646879180278418636168591508356794512283690726832563637807756258281418730175454264999171934959192604705708928596105877411516381994118739835768338965546489660559832169083538708579572471173711093730646988981218696810899954952574545163806073567546929824053403328174970500676987704926199778253660746381782604680440314596262137823331461791125154818250050446753295920369619256906218781928415737541365850344340070949656633239447169760573778416244681825637077969298913268967924047897418422984779964569269813145544068533009693283895569476867846204890590847326110720993015588265087231405233933951653116950394166167943052417136789154352682296097630634358813744103184704372123640508080775010052000463879519318670384410550641661426364710351433097365476394926158802389961532751293434472530480550550667764607810060737970145893714736159506528480540928864450457578872422388801180179917482682068668103559758825374553366173332300841229205014008500053139069326693221695804870255551619372037435905550312542058983805596458759697049739491680381953939579268023897171038255728001518904549379276118099268109312537322550440395099657248353574526141943644877373936347975153365955508307768586455752564156546012542533661887463862546842156543588035730328656660608165966076812828112789363098385093945783704215129922226967437872606689953137803942980804585310288049249461526180742968270116616519694818913578174401184404682088632983733669577340982573584444397627579108063233564589874732703194541922348287993404962423707252673743796630942433122034169156933061315842600194670225474983983624283635280874053972408008929446834874875537588889956492053433572355134573943453315212014480016086989568794927395075819202852689352133058398053328292693575806325243809011465059021418557778507982448385729805895880282972448002247640233723542619175630477906610387064420470962830728152117658990640953289632196861877258174270265803235651740430828689694270783217772311782263117190037322555874624598650884752109172986899024596076920159932294855990895197990423706160401657816339175831632532696852501275762567075563358031012453994883091204573481391519490079909014993536541015987174691626876897677927014751633878612959067507352462144418107249191916524694684674717899450821520964036243816590556876087225962980210089773410005923096704505753467665352236012021838689607571949661175717354994375101837358323044736523372226142313118119536137644839795819167259589622036688621603283603229468308189722196469592766450609395614552705192529286351908484897829116222923523241928115537641102258217494439968260788335642317279816130219088575514809535377721315121462156162403058358471469467926140126838692926318912679464038913978263338475992249493146129570044378377285401722137610559119935733848569541059042630380576826170701265713596832291037781457348660936744847065097913379764063226722158157402140829938474844355004445392665001005433446887630636024650870363639384991946975703596457940067453409372183884655032660478737612708284508047793396880644920378368934080864059656029449053380157301665202213699493749599925942263947862466227361993871700386272764336107537586798123551475371375854086136441434692760885989835902904463936025771941040145480964735861622836168139933519555184053030292627368775616912810362617773051385970783408538204207002516593561513497171201169109444110048581292662348978568404067432862527791197998933002622542190053937428896137350951365702135534860854337992425727403610880747915487926618745701162694663902084240345130707132785469214087955773410278595129442306414293630263667431996206038198929962977987632216634041214734309265140290291794172910488714781435866907436498745035104290703513551587864781617591386190430705452166783992025127173807504174592907544210390276046467075375410561490342855425414466239727935750679966074094273961577503003833975267633617748909370639977176752863153264235463173450940732460687025684153373210896765747778516052207363940704857873085713086839785505362247105551362562251084812751753100602756564536667271719578542105204676492304221446654731102246196145251115481105843660469014353761597708112406536136299364686606248229524512345159026673804056018470955808130441446687155372341621226199483914755757754722250984994350022611517343625670485903028067491388336236876745029212667119008705540716989689663107308188157876558080245892710061243708594132189893040454305502807539332819569696385338827949985488532047516621959837728779657601672830070748811159569201850769676539660267434008140387976200839891690380936721884628192614604069588253606926293196857757845555453474988090344113416733684566780287102078329925442405356921625742555449443355053076453049935264015023153906840750530793470670297973914277582139865740118881373359566023551223764901115942884057969106857141130371581867677362727032375848451582432225341292154123981105546996824534300010874345523440812862922425598479470512786934624471822519776692268323338695758553697132245040264464396793591519067705769154376212549032162750240722351009557046607773376653352323369451434896520138629467566938825879274916337510493488990878311595112222018894174419037405836987821675317346804065844066151489418623189174244009779722431917664832572568859590171522830946514526293342464568096027993198733999481452750358181978242417001798157545820198476691788808068482349817278737309097864542663270298254603551650486746966781585550936825248115991348000685271095202745339575313167042228078717678031268001162736998957071555335551132578146321919523019576403581543286695432144260609831804381760323382386977407286381169205576726416436602553445962934930919883048973713040191099492853046010406158076174840975691149950852974362070269095397688912403367559575821019459059106455846399082411468509421571751043655029821073254392653157237722213561555676932871885348163217993141728768540670771086454339858467348424738150789700140648628848951429544993476007361522892992499586122214280614941480818586661703852833117206188667148214679701964080048838577321086980291881564672354646437780859659388635052477092174364367122575203493844597519010699855103487208367375148311235728868690779708760895532701416584413143978172455482163841308772866634053572960768173825200934644795929956648725462710162069931540215037746411807868917598935292845655819814720620397349904863901207244601550139939337416831847333968141183187754060902925592228267880371253011606828079819780853381784728289011095689176149648382281395800450565885274112385993039596798396000044530356633864319005756371903306633849138764363286111732942118403910418050128792642466428452951650669088971553617303007861289613349247198337929159142817445533860946691472673180738379409774639661293057608773928446708238267075492540934991846251506837799686727930609469846959200462790734843067336429315242308194985818221783975059448646171294233097161752122562027401785014799654177396380591415697074347342033482436162277516237167555543861956940856497262639727132435512854687166915561687618056597990389722807465692896365493954608704478621841852772090344494191133509065924421731925398478553788482515880072178633680219730977281087795225315133264016662832783403404728439887804543004691939306514249873045733285686022353805887837893268345762024067698766794261466921967661759132938105153091448486357502781889524221242042254277499943311983047641322807433267792208815912169091640536511131268118721047338134497751271585890307613612174755863040866295354855224405016652766979828977024182219748050811894240972802937770814810666566399252932720920001281343330885571745438992397367482843409203005742582414597932792163483456088830672768864369323510408362749021974769710507584546820563754374040743597149687378098452874194208992694491384281259180987430130446775996588567581020868022908338664202881902312986213628244872077029382198784271245280985758196122082724669440248234610395615209964922764126698704466198924636351534139247609626629779862933058420141146257582721686322845712103641919391891282537626846500056812111464751780136012998421498954772071171273557521347308581821724578831920707242303179633080673049015096401846890380808945038789706976907087600934297556447904370780062085573792791830748860034640877153316589301770042287111941466616338434107130426406587132419300511176557090060465549939475467626620789559636103522625585757588508339075023670184906831607158329746459656981381903778582437871214402591690778563723164181305177728059970866176313075637719625203232486225383078916013798494690682408676117106490822441448447262583051706276249600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    )
  }
}
